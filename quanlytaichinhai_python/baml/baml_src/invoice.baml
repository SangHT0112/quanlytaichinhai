class Transaction {
  type string @description("Loáº¡i giao dá»‹ch: vÃ­ dá»¥ 'expense'")
  amount float @description("Sá»‘ tiá»n Ä‘Ã£ chi tiÃªu cho mÃ³n hÃ ng")
  category string @description("PhÃ¢n loáº¡i chi tiÃªu, vÃ­ dá»¥: Ä‚n uá»‘ng")
  description string @description("TÃªn mÃ³n hÃ ng hoáº·c dá»‹ch vá»¥")
}

class Invoices {
  group_name string @description("TÃªn cá»­a hÃ ng hoáº·c Ä‘Æ¡n vá»‹ bÃ¡n hÃ ng ghi trÃªn hÃ³a Ä‘Æ¡n")
  transaction_date string @description("NgÃ y giao dá»‹ch, Ä‘á»‹nh dáº¡ng yyyy-mm-dd")
  total_amount float @description("Tá»•ng tiá»n thanh toÃ¡n")
  transactions Transaction[] @description("Danh sÃ¡ch cÃ¡c giao dá»‹ch Ä‘Æ°á»£c ghi nháº­n trong hÃ³a Ä‘Æ¡n")
}




function ExtractInvoices(images: image[]) -> Invoices {
  client "ollama/llama3"
  prompt #"
    {{_.role("user")}}
    HÃ£y trÃ­ch xuáº¥t cÃ¡c thÃ´ng tin tá»« hÃ³a Ä‘Æ¡n sau:
    - TrÆ°á»ng `group_name` lÃ  tÃªn cá»­a hÃ ng/quÃ¡n Äƒn Ä‘Æ°á»£c in trÃªn Ä‘áº§u hÃ³a Ä‘Æ¡n. Náº¿u khÃ´ng xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c rÃµ rÃ ng, hÃ£y Ä‘oÃ¡n tá»« pháº§n cÃ³ font to hoáº·c ná»•i báº­t nháº¥t trÃªn hÃ³a Ä‘Æ¡n. Náº¿u váº«n khÃ´ng cÃ³, hÃ£y Ä‘áº·t lÃ  "HÃ³a Ä‘Æ¡n".
    - NgÃ y giao dá»‹ch (transaction_date)
    - Tá»•ng sá»‘ tiá»n thanh toÃ¡n (total_amount)
    - Danh sÃ¡ch cÃ¡c mÃ³n hÃ ng Ä‘Ã£ mua (transactions) gá»“m: loáº¡i, sá»‘ tiá»n, phÃ¢n loáº¡i, mÃ´ táº£

     ğŸ“‚ Danh sÃ¡ch category Ä‘Æ°á»£c nháº­n: ['LÆ°Æ¡ng', 'Ä‚n uá»‘ng', 'Di chuyá»ƒn', 'Giáº£i trÃ­', 'HÃ³a Ä‘Æ¡n', 'Y táº¿', 'NhÃ  cá»­a', 'GiÃ¡o dá»¥c', 'Du lá»‹ch', 'Thá»ƒ thao', 'ThÆ°á»Ÿng']
     HÃ£y Ä‘áº£m báº£o ráº±ng trÆ°á»ng `category` cá»§a má»—i giao dá»‹ch pháº£i thuá»™c danh sÃ¡ch trÃªn. Náº¿u khÃ´ng rÃµ, hÃ£y chá»n giÃ¡ trá»‹ gáº§n Ä‘Ãºng nháº¥t.
     
    {% for img in images %}
    [áº¢nh {{loop.index}}]
    {{ img }}
    {% endfor %}

    Tráº£ vá» Ä‘Ãºng theo Ä‘á»‹nh dáº¡ng sau:
    {
      "group_name": "...",
      "transaction_date": "...",
      "total_amount": ...,
      "transactions": [
        {
          "type": "expense",
          "amount": ...,
          "category": "...",
          "description": "..."
        },
        ...
      ]
    }
    
    {{ ctx.output_format }}
  "#
}
